<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人任务管理器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .module {
            background-color: rgba(255, 255, 255, 0.93);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            flex: 1;
            min-width: 300px;
            transition: transform 0.3s ease;
        }
        
        .module:hover {
            transform: translateY(-5px);
        }
        
        .module-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .module-title i {
            color: #3498db;
        }
        
        .input-area {
            display: flex;
            margin-bottom: 25px;
        }
        
        input, textarea, select {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px 0 0 12px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        textarea {
            height: 80px;
            resize: vertical;
            font-family: inherit;
        }
        
        button {
            padding: 15px 25px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            color: white;
            border: none;
            border-radius: 0 12px 12px 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            background: linear-gradient(to right, #2980b9, #27ae60);
            transform: scale(1.03);
        }
        
        .task-item, .log-item {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        
        .task-item:hover, .log-item:hover {
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .task-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .task-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }
        
        .task-text {
            font-size: 1.1rem;
            flex: 1;
        }
        
        .completed {
            text-decoration: line-through;
            color: #95a5a6;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
        }
        
        .log-date {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 3px;
            font-size: 0.95rem;
        }
        
        .time-period {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .log-content {
            color: #555;
            line-height: 1.5;
        }
        
        .data-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .data-btn {
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .export-btn {
            background: linear-gradient(to right, #9b59b6, #e74c3c);
        }
        
        .export-btn:hover {
            background: linear-gradient(to right, #8e44ad, #c0392b);
        }
        
        .import-btn {
            background: linear-gradient(to right, #2ecc71, #3498db);
        }
        
        .import-btn:hover {
            background: linear-gradient(to right, #27ae60, #2980b9);
        }
        
        .signature {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem; /* 缩小字号 */
            font-style: italic;
            padding: 8px 15px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            font-family: inherit; /* 使用默认字体 */
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #95a5a6;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .data-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .data-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .task-count, .log-count {
            background-color: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .time-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-inputs input, .time-inputs select {
            border-radius: 12px;
            flex: 1;
            min-width: 150px;
        }
        
        #timePeriod {
            flex: 0.5;
        }
        
        #workContent {
            border-radius: 12px 12px 0 12px;
        }
        
        #addLogBtn {
            border-radius: 0 12px 12px 12px;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .log-date-period {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .log-details {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }
        
        .import-note {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tasks"></i> 个人任务管理器</h1>
            <p class="subtitle">高效规划每日任务，记录工作时间轨迹</p>
        </header>
        
        <div class="main-content">
            <!-- 模块一：任务管理 -->
            <section class="module">
                <div class="module-header">
                    <h2 class="module-title"><i class="fas fa-list-check"></i> 今日任务</h2>
                    <div class="task-count" id="taskCount">0 个任务</div>
                </div>
                
                <div class="input-area">
                    <input type="text" id="taskInput" placeholder="输入新的任务内容...">
                    <button id="addTaskBtn"><i class="fas fa-plus"></i> 添加任务</button>
                </div>
                
                <div id="taskList">
                    <!-- 任务列表将动态生成 -->
                    <div class="empty-state">暂无任务，添加你的第一个任务吧！</div>
                </div>
            </section>
            
            <!-- 模块二：时间记录 -->
            <section class="module">
                <div class="module-header">
                    <h2 class="module-title"><i class="fas fa-clock"></i> 工作时间记录</h2>
                    <div class="log-count" id="logCount">0 条记录</div>
                </div>
                
                <div class="time-inputs">
                    <input type="date" id="logDate" value="">
                    <input type="text" id="timePeriod" placeholder="时间段 (如: 9:00-10:30)">
                    <input type="text" id="workContent" placeholder="在这段时间内完成了什么工作...">
                </div>
                
                <div class="input-area">
                    <textarea id="logInput" placeholder="可以详细描述工作内容..."></textarea>
                    <button id="addLogBtn"><i class="fas fa-clock"></i> 添加记录</button>
                </div>
                
                <div id="logList">
                    <!-- 时间记录将动态生成 -->
                    <div class="empty-state">暂无时间记录，开始记录你的工作时间吧！</div>
                </div>
            </section>
        </div>
        
        <!-- 数据控制 -->
        <div class="data-controls">
            <button class="data-btn export-btn" id="exportBtn">
                <i class="fas fa-file-excel"></i> 导出Excel数据
            </button>
            <button class="data-btn import-btn" id="importBtn">
                <i class="fas fa-file-import"></i> 导入Excel数据
            </button>
            <input type="file" id="importFile" accept=".xlsx,.xls" style="display: none;">
        </div>
        <p class="import-note">导入数据将覆盖当前所有任务和时间记录，请谨慎操作</p>
        
        <!-- 制作标签 -->
        <div class="signature">Monson制作</div>
    </div>

    <script>
        // DOM元素
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');
        const taskCount = document.getElementById('taskCount');
        
        const logDate = document.getElementById('logDate');
        const timePeriod = document.getElementById('timePeriod');
        const workContent = document.getElementById('workContent');
        const logInput = document.getElementById('logInput');
        const addLogBtn = document.getElementById('addLogBtn');
        const logList = document.getElementById('logList');
        const logCount = document.getElementById('logCount');
        
        const exportBtn = document.getElementById('exportBtn');
        const importBtn = document.getElementById('importBtn');
        const importFile = document.getElementById('importFile');
        
        // 从本地存储加载数据
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let timeLogs = JSON.parse(localStorage.getItem('timeLogs')) || [];
        
        // 设置日期输入框的默认值为今天
        function setDefaultDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            logDate.value = `${year}-${month}-${day}`;
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            setDefaultDate();
            renderTasks();
            renderLogs();
            
            // 添加任务事件
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            
            // 添加时间记录事件
            addLogBtn.addEventListener('click', addLog);
            logInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.ctrlKey) addLog();
            });
            
            // 数据导出导入事件
            exportBtn.addEventListener('click', exportToExcel);
            importBtn.addEventListener('click', () => importFile.click());
            importFile.addEventListener('change', importFromExcel);
            
            // 监听日期变化，如果为空则重置为今天
            logDate.addEventListener('change', function() {
                if (!this.value) setDefaultDate();
            });
        });
        
        // 添加新任务
        function addTask() {
            const text = taskInput.value.trim();
            if (!text) {
                alert('请输入任务内容');
                return;
            }
            
            const newTask = {
                id: Date.now(),
                text: text,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
            saveTasks();
            renderTasks();
            taskInput.value = '';
            taskInput.focus();
        }
        
        // 添加时间记录
        function addLog() {
            const date = logDate.value;
            const period = timePeriod.value.trim();
            const content = workContent.value.trim();
            const details = logInput.value.trim();
            
            if (!date || !period || !content) {
                alert('请填写日期、时间段和工作内容');
                return;
            }
            
            // 格式化日期显示
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('zh-CN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'short'
            });
            
            const newLog = {
                id: Date.now(),
                date: date,
                formattedDate: formattedDate,
                period: period,
                content: content,
                details: details,
                createdAt: new Date().toISOString()
            };
            
            timeLogs.push(newLog);
            saveLogs();
            renderLogs();
            
            // 清空输入框（日期保留为今天）
            timePeriod.value = '';
            workContent.value = '';
            logInput.value = '';
            setDefaultDate();
            timePeriod.focus();
        }
        
        // 渲染任务列表
        function renderTasks() {
            if (tasks.length === 0) {
                taskList.innerHTML = '<div class="empty-state">暂无任务，添加你的第一个任务吧！</div>';
                taskCount.textContent = '0 个任务';
                return;
            }
            
            taskList.innerHTML = '';
            let completedCount = 0;
            
            // 按创建时间倒序排列
            const sortedTasks = [...tasks].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                
                const taskContent = document.createElement('div');
                taskContent.className = 'task-content';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'task-checkbox';
                checkbox.checked = task.completed;
                checkbox.addEventListener('change', () => toggleTask(task.id));
                
                const taskText = document.createElement('span');
                taskText.className = `task-text ${task.completed ? 'completed' : ''}`;
                taskText.textContent = task.text;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i> 删除';
                deleteBtn.addEventListener('click', () => deleteTask(task.id));
                
                taskContent.appendChild(checkbox);
                taskContent.appendChild(taskText);
                taskItem.appendChild(taskContent);
                taskItem.appendChild(deleteBtn);
                taskList.appendChild(taskItem);
                
                if (task.completed) completedCount++;
            });
            
            taskCount.textContent = `${completedCount}/${tasks.length} 个任务完成`;
        }
        
        // 渲染时间记录
        function renderLogs() {
            if (timeLogs.length === 0) {
                logList.innerHTML = '<div class="empty-state">暂无时间记录，开始记录你的工作时间吧！</div>';
                logCount.textContent = '0 条记录';
                return;
            }
            
            logList.innerHTML = '';
            
            // 按日期和时间段排序（最近的在前）
            const sortedLogs = [...timeLogs].sort((a, b) => {
                // 首先按日期排序
                const dateCompare = new Date(b.date) - new Date(a.date);
                if (dateCompare !== 0) return dateCompare;
                
                // 如果日期相同，按创建时间排序
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            sortedLogs.forEach(log => {
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                
                const logContent = document.createElement('div');
                logContent.className = 'log-content';
                
                const logHeader = document.createElement('div');
                logHeader.className = 'log-header';
                
                const datePeriod = document.createElement('div');
                datePeriod.className = 'log-date-period';
                
                const date = document.createElement('div');
                date.className = 'log-date';
                date.innerHTML = `<i class="far fa-calendar"></i> ${log.formattedDate || log.date}`;
                
                const period = document.createElement('div');
                period.className = 'time-period';
                period.innerHTML = `<i class="far fa-clock"></i> ${log.period}`;
                
                datePeriod.appendChild(date);
                datePeriod.appendChild(period);
                
                const work = document.createElement('div');
                work.className = 'log-work';
                work.textContent = log.content;
                
                datePeriod.appendChild(period);
                logHeader.appendChild(datePeriod);
                logContent.appendChild(logHeader);
                logContent.appendChild(work);
                
                if (log.details) {
                    const details = document.createElement('div');
                    details.className = 'log-details';
                    details.textContent = log.details;
                    logContent.appendChild(details);
                }
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i> 删除';
                deleteBtn.addEventListener('click', () => deleteLog(log.id));
                
                logItem.appendChild(logContent);
                logItem.appendChild(deleteBtn);
                logList.appendChild(logItem);
            });
            
            logCount.textContent = `${timeLogs.length} 条记录`;
        }
        
        // 切换任务完成状态
        function toggleTask(id) {
            tasks = tasks.map(task => {
                if (task.id === id) {
                    return { ...task, completed: !task.completed };
                }
                return task;
            });
            
            saveTasks();
            renderTasks();
        }
        
        // 删除任务
        function deleteTask(id) {
            if (confirm('确定要删除这个任务吗？')) {
                tasks = tasks.filter(task => task.id !== id);
                saveTasks();
                renderTasks();
            }
        }
        
        // 删除时间记录
        function deleteLog(id) {
            if (confirm('确定要删除这条记录吗？')) {
                timeLogs = timeLogs.filter(log => log.id !== id);
                saveLogs();
                renderLogs();
            }
        }
        
        // 保存任务到本地存储
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }
        
        // 保存时间记录到本地存储
        function saveLogs() {
            localStorage.setItem('timeLogs', JSON.stringify(timeLogs));
        }
        
        // 导出数据到Excel
        function exportToExcel() {
            // 准备任务数据
            const tasksData = tasks.map(task => ({
                '任务内容': task.text,
                '状态': task.completed ? '已完成' : '未完成',
                '创建时间': new Date(task.createdAt).toLocaleString('zh-CN')
            }));
            
            // 准备时间记录数据
            const logsData = timeLogs.map(log => ({
                '日期': log.date,
                '时间段': log.period,
                '工作内容': log.content,
                '详细描述': log.details || '',
                '记录时间': new Date(log.createdAt).toLocaleString('zh-CN')
            }));
            
            // 创建工作簿
            const wb = XLSX.utils.book_new();
            
            // 创建工作表
            const tasksWs = XLSX.utils.json_to_sheet(tasksData);
            const logsWs = XLSX.utils.json_to_sheet(logsData);
            
            // 设置列宽
            const tasksColWidths = [
                { wch: 40 }, // 任务内容
                { wch: 15 }, // 状态
                { wch: 25 }  // 创建时间
            ];
            
            const logsColWidths = [
                { wch: 15 }, // 日期
                { wch: 20 }, // 时间段
                { wch: 40 }, // 工作内容
                { wch: 50 }, // 详细描述
                { wch: 25 }  // 记录时间
            ];
            
            tasksWs['!cols'] = tasksColWidths;
            logsWs['!cols'] = logsColWidths;
            
            // 将工作表添加到工作簿
            XLSX.utils.book_append_sheet(wb, tasksWs, '任务列表');
            XLSX.utils.book_append_sheet(wb, logsWs, '工作时间记录');
            
            // 生成Excel文件并下载
            const fileName = `任务与时间记录_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert('数据导出成功！文件已下载。');
        }
        
        // 从Excel导入数据
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!confirm('导入数据将覆盖当前所有任务和时间记录，确定要继续吗？')) {
                importFile.value = '';
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // 清空当前数据
                    tasks = [];
                    timeLogs = [];
                    
                    // 解析任务数据
                    if (workbook.Sheets['任务列表']) {
                        const tasksSheet = workbook.Sheets['任务列表'];
                        const tasksJson = XLSX.utils.sheet_to_json(tasksSheet);
                        
                        tasksJson.forEach(item => {
                            const newTask = {
                                id: Date.now() + Math.random(),
                                text: item['任务内容'] || item['任务'] || '',
                                completed: (item['状态'] === '已完成' || item['完成状态'] === '已完成') ? true : false,
                                createdAt: item['创建时间'] ? new Date(item['创建时间']).toISOString() : new Date().toISOString()
                            };
                            tasks.push(newTask);
                        });
                    }
                    
                    // 解析时间记录数据
                    if (workbook.Sheets['工作时间记录']) {
                        const logsSheet = workbook.Sheets['工作时间记录'];
                        const logsJson = XLSX.utils.sheet_to_json(logsSheet);
                        
                        logsJson.forEach(item => {
                            // 格式化日期显示
                            let dateValue = item['日期'];
                            let formattedDate = '';
                            
                            if (dateValue) {
                                try {
                                    const dateObj = new Date(dateValue);
                                    formattedDate = dateObj.toLocaleDateString('zh-CN', { 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric',
                                        weekday: 'short'
                                    });
                                } catch (e) {
                                    formattedDate = dateValue;
                                }
                            }
                            
                            const newLog = {
                                id: Date.now() + Math.random(),
                                date: dateValue || new Date().toISOString().split('T')[0],
                                formattedDate: formattedDate,
                                period: item['时间段'] || '',
                                content: item['工作内容'] || '',
                                details: item['详细描述'] || '',
                                createdAt: item['记录时间'] ? new Date(item['记录时间']).toISOString() : new Date().toISOString()
                            };
                            timeLogs.push(newLog);
                        });
                    }
                    
                    // 保存并重新渲染
                    saveTasks();
                    saveLogs();
                    renderTasks();
                    renderLogs();
                    
                    alert(`数据导入成功！\n导入了 ${tasks.length} 个任务和 ${timeLogs.length} 条时间记录。`);
                    importFile.value = '';
                    
                } catch (error) {
                    alert('导入失败，请确保文件格式正确或检查Excel文件内容');
                    console.error(error);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 添加示例数据（第一次使用时）
        if (!localStorage.getItem('hasExampleData')) {
            tasks = [
                { id: 1, text: '完成项目需求文档', completed: true, createdAt: new Date().toISOString() },
                { id: 2, text: '团队周会', completed: false, createdAt: new Date().toISOString() },
                { id: 3, text: '编写代码功能模块', completed: false, createdAt: new Date().toISOString() },
                { id: 4, text: '测试系统功能', completed: false, createdAt: new Date().toISOString() }
            ];
            
            // 添加示例时间记录（包含日期）
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const formatDate = (date) => {
                return date.toLocaleDateString('zh-CN', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'short'
                });
            };
            
            timeLogs = [
                { 
                    id: 1, 
                    date: today.toISOString().split('T')[0],
                    formattedDate: formatDate(today),
                    period: '9:00-10:30', 
                    content: '完成项目需求分析', 
                    details: '与产品经理讨论功能需求，明确项目目标',
                    createdAt: new Date().toISOString() 
                },
                { 
                    id: 2, 
                    date: today.toISOString().split('T')[0],
                    formattedDate: formatDate(today),
                    period: '10:45-12:00', 
                    content: '设计数据库结构', 
                    details: '创建ER图，定义数据表关系',
                    createdAt: new Date().toISOString() 
                },
                { 
                    id: 3, 
                    date: yesterday.toISOString().split('T')[0],
                    formattedDate: formatDate(yesterday),
                    period: '14:00-16:30', 
                    content: '学习新技术框架', 
                    details: '研究Vue 3.0的新特性，编写示例代码',
                    createdAt: new Date().toISOString() 
                }
            ];
            
            saveTasks();
            saveLogs();
            localStorage.setItem('hasExampleData', 'true');
            
            renderTasks();
            renderLogs();
        }
    </script>
</body>
</html>